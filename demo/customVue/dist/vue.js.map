{"version":3,"file":"vue.js","sources":["../src/compiler/index.js","../src/utils/index.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["/**\n * 主要做了两个操作\n * 1. 将template 生成ast语法树\n * 2. 生成render函数\n * @param {*} template \n */\n\nexport function compileToFunctions(template) {\n  console.log(template)\n  // TODO 待补充\n}","export const def = function (obj, key, value) {\n  Object.defineProperty(obj, key, {\n    enumerable: false,\n    value,\n  });\n};\n","const oldArrayProto = Array.prototype;\n\n// newArrayProto.__proto__ = Array.prototype\nexport let newArrayProto = Object.create(oldArrayProto);\n\n// 需要重写的是可能会改变当前数组本身的操作\nconst methods = [\n  \"push\",\n  \"pop\",\n  \"shift\",\n  \"unshift\",\n  \"splice\",\n  \"sort\",\n  \"reverse\",\n];\n\nmethods.forEach((method) => {\n  newArrayProto[method] = function (...args) {\n    console.log(\"执行了自定义方法\", args);\n    let result = oldArrayProto[method].call(this, ...args);\n    const ob = this.__ob__;\n    // push unshift splice\n    let inserted;\n    switch (method) {\n      case \"push\":\n      case \"unshift\":\n        inserted = args;\n        break;\n      case \"splice\":\n        // splice(0, 2, {name:2}, {name:3})\n        inserted = args.slice(2);\n        break;\n      default:\n        break;\n    }\n    if (inserted) {\n      ob.observeArray(inserted);\n    }\n    console.log(\"新增数据\", inserted);\n    return result;\n  };\n});\n","import { def } from \"../utils/index\";\nimport { newArrayProto } from \"./array\";\n\nclass Observer {\n  constructor(data) {\n    /**\n     * object.defineProperty 只能劫持当前存在的属性，对新增的和删除的监听不到\n     * 因此在Vue2中需要写一些单独的api 比如 $set $delete\n     */\n    // 将__ob__变成不可枚举，这样循环的时候就无法枚举当前属性了\n    def(data, '__ob__', this)\n    // Object.defineProperty(data, \"__ob__\", {\n    //   enumerable: false,\n    //   value: this,\n    // });\n    // data.__ob__ = this;\n    if (Array.isArray(data)) {\n      data.__proto__ = newArrayProto;\n      // data.push() -> 这里的data就是push自定义中的执行上下文（this）\n      this.observeArray(data);\n    } else {\n      this.walk(data);\n    }\n  }\n  walk(obj) {\n    // 循环对象对属性进行依次劫持\n    // 此处会重新定义属性，相当于把data中的数据重新复制一遍\n    Object.keys(obj).forEach((key) => defineReactive(obj, key, obj[key]));\n  }\n  observeArray(arr) {\n    arr.forEach((data) => observe(data));\n  }\n}\n\n/**\n * 把当前的对象定义为响应式(这个方法可以在$set 和 $delete中使用)\n * @param {*} obj 对象\n * @param {*} key 键名\n * @param {*} val 键值\n */\nexport function defineReactive(obj, key, value) {\n  // 对所有对象都进行属性劫持\n  observe(value);\n  Object.defineProperty(obj, key, {\n    configurable: true,\n    enumerable: true,\n    get() {\n      console.log(\"get\", value);\n      return value;\n    },\n    set(newValue) {\n      // 更新value\n      if (value === newValue) {\n        return;\n      }\n      console.log(\"set\", newValue);\n      value = newValue;\n    },\n  });\n}\n\nexport function observe(data) {\n  if (typeof data !== \"object\" || data === null) {\n    return;\n  }\n  if (data.__ob__ instanceof Observer) {\n    return data.__ob__;\n  }\n  // 添加属性标记，如果一个实例被创建过或者被标记过就不标记直接返回\n  return new Observer(data);\n}\n","import { observe } from \"./observe/index\";\n/**\n * 实现数据的代理，可由vm.xxx 代理到 vm._data上\n * @param {*} target 目标对象\n * @param {*} sourceKey 当前key对应真实位置\n * @param {*} key 被查找的key\n */\nfunction proxy(target, sourceKey, key) {\n  // vm[name] -> vm[sourceKey][key]\n  Object.defineProperty(target, key, {\n    get() {\n      return target[sourceKey][key];\n    },\n    set(newValue) {\n      target[sourceKey][key] = newValue;\n    },\n  });\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data;\n  // data 可能是函数也可能是一个对象\n  // 如果是函数希望执行\n  // 不是函数直接使用data\n  data = typeof data === \"function\" ? data.call(vm) : data;\n  vm._data = data;\n  // 响应式实现，对data进行劫持\n  observe(data);\n  Object.keys(data).forEach(key => {\n    proxy(vm, '_data', key)\n  })\n}\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  // 初始化data、props、method等\n  if (opts.data) {\n    initData(vm);\n  }\n}\n","import { compileToFunctions } from \"./compiler/index\";\nimport { initState } from \"./state\";\n\nfunction initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    // 在init里面我们可以做一些初始化的操作\n    // 在Vue中一般使用 $xxx 来表示一些Vue的私有属性\n    // 在Vue源码中，此处其实是做了一个参数合并的动作\n    // 将用户的操作挂载在实例上\n    this.$options = options;\n    vm._self = vm;\n    initState(vm);\n    // 初始化状态，比如 data/computed/props等等\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el);\n    }\n  };\n  Vue.prototype.$mount = function (el) {\n    const vm = this;\n    el = document.querySelector(el);\n    const opts = vm.$options;\n    // 先查找render\n    if (!opts.render) {\n      let template = opts.template;\n      // 如果当前没有render没那就解析template\n      if (!template && el) {\n        // 有template解析template，没有就解析使用el获取dom元素\n        // outerHTML获取序列化后的html片段\n        template = el.outerHTML;\n      }\n      if (template) {\n        // 如果有模板需要对模板进行编译，即 html -> ast语法树\n        // 生成render函数，并挂载到opts上\n        const render = compileToFunctions(template)\n        // jsx -> 渲染函数 h('div', { ... 描述 })\n        opts.render = render\n      }\n    }\n  };\n}\nexport default initMixin;\n","import initMixin from \"./init\";\n\nfunction Vue(options) {\n  this._init(options);\n}\n\ninitMixin(Vue)\n\nexport default Vue"],"names":[],"mappings":"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"}