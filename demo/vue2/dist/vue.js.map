{"version":3,"file":"vue.js","sources":["../src/compile/parser/index.js","../src/compile/index.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 属性匹配：《 v-bind:test=\"msg\" 》\n// id=\"app\"\nconst attribute =\n  /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\n// 匹配开始的标签<div\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 判断是否为开始标签的开头 <\n// 匹配开始的结束标签>\nconst startTagClose = /^\\s*(\\/?)>/; // 判断是否为开始标签的结尾 >\n// 匹配关闭标签 </div>\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 判断是否为闭标签， </xxx>\n/**\n * <div id=\"app\">\n      text\n      <span>{{msg}}</span>\n      <span>{{msg}}</span>\n    </div>\n * @param {*} html \n */\n\n    export function parseHTML(html) {\n  console.log(html);\n  while (html) {\n    let textEnd = html.indexOf(\"<\");\n    if (textEnd === 0) {\n      const endTagMatch = html.match(endTag);\n      if (endTagMatch) {\n        advance(endTagMatch[0].length)\n        continue;\n      }\n      const startTagMatch = parseStartTag();\n    }\n    if (textEnd > 0) {\n      const text = html.substring(0, textEnd);\n      if (text) {\n        advance(text.length);\n      }\n    }\n  }\n  console.log('---', html);\n  function advance(index) {\n    html = html.substring(index);\n  }\n  function parseStartTag() {\n    const start = html.match(startTagOpen);\n    if (start) {\n      // 开始标签\n      const match = {\n        tagName: start[1], // 标签名\n        attrs: [], // 属性\n      };\n      advance(start[0].length);\n      let end, attr;\n      while (\n        !(end = html.match(startTagClose)) &&\n        (attr = html.match(attribute))\n      ) {\n        match.attrs.push({\n          name: attr[1],\n          value: attr[3] || attr[4] || attr[5],\n        });\n        advance(attr[0].length);\n      }\n      if (end) {\n        advance(end[0].length);\n      }\n    }\n    return false;\n  }\n}\n","import { parseHTML } from \"./parser/index\"\n\n/**\n * 模板引擎，\n * 1. 解析html，生成ast语法树\n * 2. 根据ast语法树生成render函数\n * 3. render函数将\n * @param {String} html \n */ \nexport function compileToFunctions(html) {\n  const ast = parseHTML(html)\n}","class Observer {\n  constructor(data) {\n    // TODO 数组劫持区分\n    this.walk(data);\n  }\n  walk(data) {\n    Object.keys(data).forEach((key) => defineReactive(data, key, data[key]));\n  }\n}\n/**\n *\n * @param {*} target 目标对象\n * @param {*} key 需要拦截的键值\n * @param {*} value 当前获取的键值对应的数据\n */\nfunction defineReactive(target, key, value) {\n  // 对象 key {  }\n  // 拦截取值的过程\n  // 拦截赋值的过程\n  observe(value);\n  // 只能拦截当前target 存在的 key\n  Object.defineProperty(target, key, {\n    configurable: true,\n    enumerable: true,\n    get() {\n      console.log(\"get\", value);\n      return value;\n    },\n    set(newValue) {\n      if (newValue === value) {\n        return;\n      }\n      console.log(\"set\", newValue);\n      observe(newValue);\n      value = newValue;\n    },\n  });\n}\n\nexport function observe(data) {\n  if (typeof data !== \"object\" || data === null) {\n    return;\n  }\n  return new Observer(data);\n}\n","import { observe } from \"./observe/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.data) {\n    initData(vm);\n  }\n}\n/**\n * vm.msg -> vm._data.msg\n * @param {*} target 我要获取目标对象\n * @param {*} sourceKey 这个key值真正存在的位置\n * @param {*} key 需要获得key\n */\nfunction proxy(target, sourceKey, key) {\n  // vm.msg -> vm._data.msg\n  // target => vm\n  // key => msg\n  // sourceKey => _data\n  Object.defineProperty(target, key, {\n    configurable: true,\n    enumerable: true,\n    get() {\n      return target[sourceKey][key]\n    },\n    set(newValue) {\n      target[sourceKey][key] = newValue\n    }\n  })\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data;\n  data = typeof data === \"function\" ? data.call(vm) : data || {};\n  // observe(data)\n  // _ $ \n  vm._data = data\n  observe(data)\n  // vm.key -> vm._data.key\n  Object.keys(data).forEach(key => proxy(vm, '_data', key))\n}\n","import { compileToFunctions } from \"./compile/index\";\nimport { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    console.log(options);\n    const vm = this;\n    // mergeOptions $ _\n    vm.$options = options;\n    // data  props method\n    initState(vm);\n    vm._self = vm;\n    if (vm.$options.el) {\n      this.$mount(vm.$options.el);\n    }\n  };\n  // template -> js\n  // AST语法转换: 抽象\n  // html -> ast -> js -> 虚拟DOM\n  // runtime-only\n  // runtime-with-compiler\n  Vue.prototype.$mount = function (el) {\n    // 有render用render\n    // 没有render看template\n    // 没有template用el\n    const vm = this;\n    el = document.querySelector(el);\n    const opts = vm.$options;\n    if (!opts.render) {\n      let template = opts.template;\n      if (!template && el) {\n        template = el.outerHTML;\n      }\n      if (template) {\n        // 拿到template后根据当前的template生成render\n        const render = compileToFunctions(template);\n        opts.render = render;\n      }\n    }\n  };\n}\n","import { initMixin } from \"./init\"\n\nfunction Vue(options) {\n  this._init(options)\n}\n\ninitMixin(Vue)\n\nexport default Vue"],"names":[],"mappings":"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"}