{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["class Observer {\n  constructor(data) {\n    // TODO 数组劫持区分\n    this.walk(data);\n  }\n  walk(data) {\n    Object.keys(data).forEach((key) => defineReactive(data, key, data[key]));\n  }\n}\n/**\n *\n * @param {*} target 目标对象\n * @param {*} key 需要拦截的键值\n * @param {*} value 当前获取的键值对应的数据\n */\nfunction defineReactive(target, key, value) {\n  // 对象 key {  }\n  // 拦截取值的过程\n  // 拦截赋值的过程\n  observe(value);\n  // 只能拦截当前target 存在的 key\n  Object.defineProperty(target, key, {\n    configurable: true,\n    enumerable: true,\n    get() {\n      console.log(\"get\", value);\n      return value;\n    },\n    set(newValue) {\n      if (newValue === value) {\n        return;\n      }\n      console.log(\"set\", newValue);\n      observe(newValue);\n      value = newValue;\n    },\n  });\n}\n\nexport function observe(data) {\n  if (typeof data !== \"object\" || data === null) {\n    return;\n  }\n  return new Observer(data);\n}\n","import { observe } from \"./observe/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.data) {\n    initData(vm);\n  }\n}\n/**\n * vm.msg -> vm._data.msg\n * @param {*} target 我要获取目标对象\n * @param {*} sourceKey 这个key值真正存在的位置\n * @param {*} key 需要获得key\n */\nfunction proxy(target, sourceKey, key) {\n  // vm.msg -> vm._data.msg\n  // target => vm\n  // key => msg\n  // sourceKey => _data\n  Object.defineProperty(target, key, {\n    configurable: true,\n    enumerable: true,\n    get() {\n      return target[sourceKey][key]\n    },\n    set(newValue) {\n      target[sourceKey][key] = newValue\n    }\n  })\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data;\n  data = typeof data === \"function\" ? data.call(vm) : data || {};\n  // observe(data)\n  // _ $ \n  vm._data = data\n  observe(data)\n  // vm.key -> vm._data.key\n  Object.keys(data).forEach(key => proxy(vm, '_data', key))\n}\n","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    console.log(options);\n    const vm = this;\n    // mergeOptions $ _\n    vm.$options = options;\n    // data  props method\n    initState(vm);\n    vm._self = vm;\n    if (vm.$options.el) {\n      this.$mount(vm.$options.el);\n    }\n  };\n  // template -> js\n  // AST语法转换: 抽象\n  // html -> ast -> js -> 虚拟DOM\n  // runtime-only\n  // runtime-with-compiler （采用这种，render函数自己生成的过程）\n  Vue.prototype.$mount = function (el) {\n    // 有render用render\n    // 没有render看template\n    // 没有template用el\n    const vm = this;\n    el = document.querySelector(el);\n    const opts = vm.$options;\n    if (!opts.render) {\n      let template = opts.template;\n      if (!template && el) {\n        template = el.outerHTML;\n      }\n      if (template) {\n        // 拿到template后根据当前的template生成render\n        const render = compileToFunctions(template);\n        opts.render = render;\n      }\n    }\n    console.log(opts.render);\n    // 页面的初渲染\n    mountComponent(vm, el);\n  };\n}\n","import { initMixin } from \"./init\"\n\nfunction Vue(options) {\n  this._init(options)\n}\n\ninitMixin(Vue)\nexport default Vue"],"names":[],"mappings":"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"}